name: Deploy Lovable Site to Tencent Cloud

on:
  push:
    branches: [ "main" ] # 监听 Lovable 默认推送的分支

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 1. 检出代码
        uses: actions/checkout@v4

      - name: 2. 安装 Node.js 并打包项目
        run: |
          npm install
          npm run build # Lovable/Vite 项目打包后会生成 dist 目录

      - name: 3. 通过 SSH 把打包后的文件传送到腾讯云
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          source: "dist/*"
          target: "/var/www/geo-zhinao" # 对应你在腾讯云创建的目录
          strip_components: 1

      - name: 4. 部署完成通知
        run: echo " 网站更新成功！"
